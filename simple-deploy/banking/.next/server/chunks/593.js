"use strict";exports.id=593,exports.ids=[593],exports.modules={47458:(e,t,a)=>{a.r(t),a.d(t,{$$ACTION_0:()=>i,$$ACTION_1:()=>u,$$ACTION_2:()=>f,$$ACTION_3:()=>w,$$ACTION_4:()=>h,addFundingSource:()=>m,createDwollaCustomer:()=>l,createFundingSource:()=>s,createOnDemandAuthorization:()=>d,createTransfer:()=>b});var n=a(71577);a(90710);var r=a(77419),c=a(93205);let o=new r.Client({environment:(()=>{switch(process.env.DWOLLA_ENV){case"sandbox":return"sandbox";case"production":return"production";default:throw Error("Dwolla environment should either be set to `sandbox` or `production`")}})(),key:process.env.DWOLLA_KEY,secret:process.env.DWOLLA_SECRET}),s=(0,n.j)("145d25530d361400f8c0e03a2246b031736ce670",i);async function i(e){try{return await o.post(`customers/${e.customerId}/funding-sources`,{name:e.fundingSourceName,plaidToken:e.plaidToken}).then(e=>e.headers.get("location"))}catch(e){console.error("Creating a Funding Source Failed: ",e)}}let d=(0,n.j)("7cdeba4b8d5a54f11560b53f07f0ea66f48465fb",u);async function u(){try{return(await o.post("on-demand-authorizations")).body._links}catch(e){console.error("Creating an On Demand Authorization Failed: ",e)}}let l=(0,n.j)("cdee6dab4e0daeb5db09c9a135ba52a62c2196c8",f);async function f(e){try{return await o.post("customers",e).then(e=>e.headers.get("location"))}catch(e){console.error("Creating a Dwolla Customer Failed: ",e)}}let b=(0,n.j)("918dacc5acf66a8711d2c4b53855d61a4305d152",w);async function w({sourceFundingSourceUrl:e,destinationFundingSourceUrl:t,amount:a}){try{return await o.post("transfers",{_links:{source:{href:e},destination:{href:t}},amount:{currency:"USD",value:a}}).then(e=>e.headers.get("location"))}catch(e){console.error("Transfer fund failed: ",e)}}let m=(0,n.j)("4d4a5c12509b890fc3ed40c3380ebde20647682c",h);async function h({dwollaCustomerId:e,processorToken:t,bankName:a}){try{let n=await d();return await s({customerId:e,fundingSourceName:a,plaidToken:t,_links:n})}catch(e){console.error("Transfer fund failed: ",e)}}(0,c.h)([s,d,l,b,m]),(0,n.j)("35dd761518f51a48793356df9624b0555588fe79",s),(0,n.j)("5a7e265742824c6cf1530dd0cbb7db95cb8f4531",d),(0,n.j)("6ab4aec36ca7aace9c1fbdc7f7bd6d156ddb7759",l),(0,n.j)("2cabda13407f7759054f6583a0cd05619a68c46b",b),(0,n.j)("e1f4143a5fe2ddcaf6150630c4a5ba0af1233862",m)},22470:(e,t,a)=>{a.r(t),a.d(t,{$$ACTION_0:()=>_,$$ACTION_1:()=>C,$$ACTION_2:()=>T,$$ACTION_3:()=>E,$$ACTION_4:()=>j,$$ACTION_5:()=>N,$$ACTION_6:()=>L,$$ACTION_7:()=>v,$$ACTION_8:()=>F,$$ACTION_9:()=>z,createBankAccount:()=>k,createLinkToken:()=>$,exchangePublicToken:()=>O,getBank:()=>U,getBankByAccountId:()=>x,getBanks:()=>P,getLoggedInUser:()=>D,getUserInfo:()=>p,logoutAccount:()=>S,signIn:()=>I,signUp:()=>A});var n=a(71577);a(90710);var r=a(31438),c=a(97793),o=a(74377),s=a(24510),i=a(85781),d=a(28600),u=a(12712),l=a(47458),f=a(93205);let{APPWRITE_DATABASE_ID:b,APPWRITE_USER_COLLECTION_ID:w,APPWRITE_BANK_COLLECTION_ID:m}=process.env,h={path:"/",httpOnly:!0,sameSite:"strict",secure:!0},y="This email isn't authorized to access Horizon. Please contact support.",g=async()=>{try{let{database:e}=await (0,c.createSessionClient)();return e}catch(t){let{database:e}=await (0,c.createAdminClient)();return e}},p=(0,n.j)("c391474a31505ae378b536f07f75f2e9cae3b0e8",_);async function _({userId:e}){try{let t=await g(),a=await t.listDocuments(b,w,[r.Query.equal("userId",[e])]);return(0,s.fM)(a.documents[0])}catch(e){console.log(e)}}let I=(0,n.j)("41198538d6c39cdb21c86e11f48c72f83aed5759",C);async function C({email:e,password:t}){try{if(!(0,i.Fj)(e))return{success:!1,error:y};let{account:a}=await (0,c.createAdminClient)(),n=await a.createEmailPasswordSession(e,t),r=await p({userId:n.userId});if(!r)return await a.deleteSession(n.$id),{success:!1,error:"Unable to locate your profile. Please contact support."};if(!(0,i.Fj)(r.email))return await a.deleteSession(n.$id),{success:!1,error:y};let d=(0,o.cookies)();return d.set("appwrite-session",n.secret,h),d.set(i.S4,r.email,h),{success:!0,data:(0,s.fM)(r)}}catch(e){return console.error("Error",e),{success:!1,error:"Unable to sign in. Please check your credentials and try again."}}}let A=(0,n.j)("50005c5c699f14f3a294171b16d72b3deb916f50",T);async function T({password:e,...t}){let a;let{email:n,firstName:d,lastName:u}=t;try{if(!(0,i.Fj)(n))return{success:!1,error:y};let{account:f,database:m}=await (0,c.createAdminClient)();if(!(a=await f.create(r.ID.unique(),n,e,`${d} ${u}`)))throw Error("Error creating user");let g=await (0,l.createDwollaCustomer)({...t,type:"personal"});if(!g)throw Error("Error creating Dwolla customer");let p=(0,s.Qb)(g),_=await m.createDocument(b,w,r.ID.unique(),{...t,userId:a.$id,dwollaCustomerId:p,dwollaCustomerUrl:g}),I=await f.createEmailPasswordSession(n,e),C=(0,o.cookies)();return C.set("appwrite-session",I.secret,h),C.set(i.S4,n,h),{success:!0,data:(0,s.fM)(_)}}catch(e){return console.error("Error",e),{success:!1,error:"Unable to sign up. Please review your details and try again."}}}async function D(){try{let{account:e}=await (0,c.createSessionClient)(),t=await e.get(),a=await p({userId:t.$id});return(0,s.fM)(a)}catch(e){return console.log(e),null}}let S=(0,n.j)("17ca3ab6b56e9365257f6f843a86e66d5f3f6473",E);async function E(){try{let{account:e}=await (0,c.createSessionClient)();(0,o.cookies)().delete("appwrite-session"),(0,o.cookies)().delete(i.S4),await e.deleteSession("current")}catch(e){return null}}let $=(0,n.j)("7f0ee6411b2acea9133ca38f8c272dfb06fc3d05",j);async function j(e){try{let t={user:{client_user_id:e.$id},client_name:`${e.firstName} ${e.lastName}`,products:["auth"],language:"en",country_codes:["US"]},a=await d.z.linkTokenCreate(t);return(0,s.fM)({linkToken:a.data.link_token})}catch(e){console.log(e)}}let k=(0,n.j)("8277fc41e254a29bb35a2b2dfa72600f0f7c843f",N);async function N({userId:e,bankId:t,accountId:a,accessToken:n,fundingSourceUrl:o,shareableId:i}){try{let{database:d}=await (0,c.createAdminClient)(),u=await d.createDocument(b,m,r.ID.unique(),{userId:e,bankId:t,accountId:a,accessToken:n,fundingSourceUrl:o,shareableId:i});return(0,s.fM)(u)}catch(e){console.log(e)}}let O=(0,n.j)("3a72c31716dcf678fb03a613ecb98008bba14249",L);async function L({publicToken:e,user:t}){try{let a=await d.z.itemPublicTokenExchange({public_token:e}),n=a.data.access_token,r=a.data.item_id,c=(await d.z.accountsGet({access_token:n})).data.accounts[0],o={access_token:n,account_id:c.account_id,processor:"dwolla"},i=(await d.z.processorTokenCreate(o)).data.processor_token,f=await (0,l.addFundingSource)({dwollaCustomerId:t.dwollaCustomerId,processorToken:i,bankName:c.name});if(!f)throw Error;return await k({userId:t.$id,bankId:r,accountId:c.account_id,accessToken:n,fundingSourceUrl:f,shareableId:(0,s.Tn)(c.account_id)}),(0,u.revalidatePath)("/"),(0,s.fM)({publicTokenExchange:"complete"})}catch(e){console.error("An error occurred while creating exchanging token:",e)}}let P=(0,n.j)("804ba20cc210e20d7947f09427826f717cad6349",v);async function v({userId:e}){try{let t=await g(),a=await t.listDocuments(b,m,[r.Query.equal("userId",[e])]);return(0,s.fM)(a.documents)}catch(e){console.log(e)}}let U=(0,n.j)("6d855c1627048a6ebd98afbc22ddad7f629ef4c5",F);async function F({documentId:e}){try{let t=await g(),a=await t.listDocuments(b,m,[r.Query.equal("$id",[e])]);return(0,s.fM)(a.documents[0])}catch(e){console.log(e)}}let x=(0,n.j)("ecbc6cf96f975980d8cd6acdd589835eba42e886",z);async function z({accountId:e}){try{let t=await g(),a=await t.listDocuments(b,m,[r.Query.equal("accountId",[e])]);if(1!==a.total)return null;return(0,s.fM)(a.documents[0])}catch(e){console.log(e)}}(0,f.h)([p,I,A,D,S,$,k,O,P,U,x]),(0,n.j)("0c6abdfc05975ca931c616070f9610a7d4edeb93",p),(0,n.j)("25721a35d2fe130c1ff474c4de7710f1cce0e709",I),(0,n.j)("9d8e523dbbfd38ae42b6ca7f1d1d2a26663bad08",A),(0,n.j)("7856b3d61afb998297a3020bd8745f8dadbfaae3",D),(0,n.j)("e2eb05fceb805a0cb45baca36f07e6c465fa249a",S),(0,n.j)("cd7ed88b570f42c314b42295d09cd6a2659196e9",$),(0,n.j)("46de93f3843589f54b84009dd3fb9d59627f4794",k),(0,n.j)("923fa2bad5a2a347bf920347118846f8171a0c84",O),(0,n.j)("76c543ac95374899df976998450aebcafeccc541",P),(0,n.j)("5ad0e2471a0e8eb9288066e0e7edc8d2d41b8e8a",U),(0,n.j)("96e8039961c618e3ba4be2eca75b43aa5c0a737d",x)},97793:(e,t,a)=>{a.r(t),a.d(t,{createAdminClient:()=>s,createSessionClient:()=>o});var n=a(71577);a(90710);var r=a(31438),c=a(74377);async function o(){let e=new r.Client().setEndpoint("https://cloud.appwrite.io/v1").setProject("662cd3d0000d7d095714"),t=(0,c.cookies)().get("appwrite-session");if(!t||!t.value)throw Error("No session");return e.setSession(t.value),{get account(){return new r.Account(e)},get database(){return new r.Databases(e)}}}async function s(){let e=new r.Client().setEndpoint("https://cloud.appwrite.io/v1").setProject("662cd3d0000d7d095714").setKey(process.env.NEXT_APPWRITE_KEY);return{get account(){return new r.Account(e)},get database(){return new r.Databases(e)},get user(){return new r.Users(e)}}}(0,a(93205).h)([o,s]),(0,n.j)("20c0c63400d137797aa5358d136bb866203214f8",o),(0,n.j)("31013b9227c35d126f40c98c903f1b22c3072ac4",s)},85781:(e,t,a)=>{a.d(t,{Fj:()=>o,S4:()=>n});let n="horizon-authorized-email",r=e=>e.trim().toLowerCase(),c=()=>{let e=process.env.ALLOWED_EMAILS;return e?e.split(",").map(e=>e.trim()).filter(e=>e.length>0).map(e=>e.toLowerCase()):[]},o=e=>{if(!e)return!1;let t=c();return 0===t.length||t.includes(r(e))}},28600:(e,t,a)=>{a.d(t,{z:()=>c});var n=a(16550);let r=new n.Configuration({basePath:n.PlaidEnvironments.sandbox,baseOptions:{headers:{"PLAID-CLIENT-ID":process.env.PLAID_CLIENT_ID,"PLAID-SECRET":process.env.PLAID_SECRET}}}),c=new n.PlaidApi(r)},24510:(e,t,a)=>{a.d(t,{A2:()=>u,Lv:()=>w,Qb:()=>f,Tn:()=>b,cn:()=>c,dN:()=>s,fM:()=>i,nC:()=>l,o0:()=>o});var n=a(36845),r=a(10676);function c(...e){return(0,r.m6)((0,n.W)(e))}let o=e=>{let t=new Date(e).toLocaleString("en-US",{weekday:"short",month:"short",day:"numeric",hour:"numeric",minute:"numeric",hour12:!0});return{dateTime:t,dateDay:new Date(e).toLocaleString("en-US",{weekday:"short",year:"numeric",month:"2-digit",day:"2-digit"}),dateOnly:new Date(e).toLocaleString("en-US",{month:"short",year:"numeric",day:"numeric"}),timeOnly:new Date(e).toLocaleString("en-US",{hour:"numeric",minute:"numeric",hour12:!0})}};function s(e){return d(e)}let i=e=>JSON.parse(JSON.stringify(e)),d=(e,t="USD")=>new Intl.NumberFormat("en-US",{style:"currency",currency:t}).format(e),u=e=>e.replace(/[^\w\s]/gi,"");function l(e){let t={},a=0;e&&e.forEach(e=>{let n=e.category;t.hasOwnProperty(n)?t[n]++:t[n]=1,a++});let n=Object.keys(t).map(e=>({name:e,count:t[e],totalCount:a}));return n.sort((e,t)=>t.count-e.count),n}function f(e){let t=e.split("/");return t[t.length-1]}function b(e){return btoa(e)}let w=e=>{let t=new Date,a=new Date(t);return a.setDate(t.getDate()-2),e>a?"Processing":"Success"}},19020:(e,t,a)=>{var n=a(79415),r="undefined"!=typeof global?global:"undefined"!=typeof self?self:{};r.__sentryRewritesTunnelPath__=void 0,r.SENTRY_RELEASE={id:"LPrcL_we37QeDKG8B7C-g"},r.__sentryBasePath=void 0,r.__rewriteFramesDistDir__=".next",n.S1({dsn:"https://e300b41df2ffb6d4592972400a25c0d3@o4506876178464768.ingest.us.sentry.io/4507159179034624",tracesSampleRate:1,debug:!1})}};
//# sourceMappingURL=593.js.map