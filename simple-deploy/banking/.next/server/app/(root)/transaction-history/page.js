(()=>{var e={};e.id=521,e.ids=[521],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},31438:e=>{"use strict";e.exports=require("node-appwrite")},27790:e=>{"use strict";e.exports=require("assert")},61212:e=>{"use strict";e.exports=require("async_hooks")},61282:e=>{"use strict";e.exports=require("child_process")},84770:e=>{"use strict";e.exports=require("crypto")},27920:e=>{"use strict";e.exports=require("diagnostics_channel")},82266:e=>{"use strict";e.exports=require("domain")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},35240:e=>{"use strict";e.exports=require("https")},66302:e=>{"use strict";e.exports=require("inspector")},98216:e=>{"use strict";e.exports=require("net")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},68621:e=>{"use strict";e.exports=require("punycode")},76162:e=>{"use strict";e.exports=require("stream")},82452:e=>{"use strict";e.exports=require("tls")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},20419:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>j,generateImageMetadata:()=>v,generateMetadata:()=>f,generateViewport:()=>b}),r(19020);var s=r(23808),a=r(87394),i=r(35247),o=r(54580),n=r(20830),l=r(82811),c=r(16671),d=r(5425),u=r(170);let p=(0,r(85418).createProxy)(String.raw`/Users/kaveh/Horizon-bank/banking/components/TransactionFilters.tsx#TransactionFilters`);var x=r(5017),m=r(22470),h=r(2732),g=r(24510);r(72077);let f=void 0,v=void 0,b=void 0,j=new Proxy(async({searchParams:e})=>{let t=Number(e.page)||1,r=await (0,m.getLoggedInUser)(),s=await (0,x.getAccounts)({userId:r.$id});if(!s)return;let a=s?.data,i=e.id||a[0]?.appwriteItemId,o=await (0,x.getAccount)({appwriteItemId:i}),f={from:e.from,to:e.to,direction:e.direction||"all"},v=(0,h.X4)(o?.transactions||[],{from:f.from,to:f.to,direction:f.direction}),b=Math.ceil(v.length/10)||1,j=10*t,y=v.slice(j-10,j),k=new URLSearchParams({bankId:i});f.from&&k.set("from",f.from),f.to&&k.set("to",f.to),f.direction&&"all"!==f.direction&&k.set("direction",f.direction);let N=`/api/transactions/export?${k.toString()}`;return(0,n.jsxs)("div",{className:"transactions",children:[(0,n.jsx)("div",{className:"transactions-header",children:(0,n.jsx)(l.Z,{title:"Transaction History",subtext:"See your bank details and transactions."})}),(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{className:"transactions-account",children:[(0,n.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,n.jsx)("h2",{className:"text-18 font-bold text-white",children:o?.data.name}),(0,n.jsx)("p",{className:"text-14 text-blue-25",children:o?.data.officialName}),(0,n.jsxs)("p",{className:"text-14 font-semibold tracking-[1.1px] text-white",children:["●●●● ●●●● ●●●● ",o?.data.mask]})]}),(0,n.jsxs)("div",{className:"transactions-account-balance",children:[(0,n.jsx)("p",{className:"text-14",children:"Current balance"}),(0,n.jsx)("p",{className:"text-24 text-center font-bold",children:(0,g.dN)(o?.data.currentBalance)})]})]}),(0,n.jsx)(p,{defaultValues:{bankId:i,from:f.from,to:f.to,direction:f.direction},exportUrl:N}),(0,n.jsxs)("section",{className:"flex w-full flex-col gap-6",children:[(0,n.jsx)("div",{className:"flex justify-end",children:(0,n.jsx)(u.r,{accounts:a,defaultBankId:i})}),(0,n.jsx)(d.Z,{transactions:y}),b>1&&(0,n.jsx)("div",{className:"my-4 w-full",children:(0,n.jsx)(c.t,{totalPages:b,page:t})})]})]})]})},{apply:(e,t,r)=>{let n,l,c;try{let e=o.requestAsyncStorage.getStore();n=(0,s.h)((0,a.x)([e,"optionalAccess",e=>e.headers,"access",e=>e.get,"call",e=>e("sentry-trace")]),()=>void 0),l=(0,s.h)((0,a.x)([e,"optionalAccess",e=>e.headers,"access",e=>e.get,"call",e=>e("baggage")]),()=>void 0),c=(0,a.x)([e,"optionalAccess",e=>e.headers])}catch(e){}return i.D(e,{componentRoute:"/(root)/transaction-history",componentType:"Page",sentryTraceHeader:n,baggageHeader:l,headers:c}).apply(t,r)}})},92820:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>i.Z,__next_app__:()=>u,originalPathname:()=>d,pages:()=>c,routeModule:()=>p,tree:()=>l}),r(20419),r(83017),r(22760),r(63835);var s=r(24636),a=r(7773),i=r(86864),o=r(46934),n={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(n[e]=()=>o[e]);r.d(t,n);let l=["",{children:["(root)",{children:["transaction-history",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,20419)),"/Users/kaveh/Horizon-bank/banking/app/(root)/transaction-history/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,83017)),"/Users/kaveh/Horizon-bank/banking/app/(root)/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,22760,23)),"next/dist/client/components/not-found-error"]}]},{layout:[()=>Promise.resolve().then(r.bind(r,63835)),"/Users/kaveh/Horizon-bank/banking/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,22760,23)),"next/dist/client/components/not-found-error"]}],c=["/Users/kaveh/Horizon-bank/banking/app/(root)/transaction-history/page.tsx"],d="/(root)/transaction-history/page",u={require:r,loadChunk:()=>Promise.resolve()},p=new s.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/(root)/transaction-history/page",pathname:"/transaction-history",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:l}})},17894:(e,t,r)=>{Promise.resolve().then(r.bind(r,14672)),Promise.resolve().then(r.bind(r,14837)),Promise.resolve().then(r.bind(r,63438))},14837:(e,t,r)=>{"use strict";r.d(t,{Pagination:()=>l});var s=r(40612),a=r(25152),i=r(20297),o=r(35326),n=r(38371);let l=({page:e,totalPages:t})=>{let r=(0,i.useRouter)(),l=(0,i.useSearchParams)(),c=t=>{let s="prev"===t?e-1:e+1,a=(0,n.Yz)({params:l.toString(),key:"page",value:s.toString()});r.push(a,{scroll:!1})};return(0,s.jsxs)("div",{className:"flex justify-between gap-3",children:[(0,s.jsxs)(o.z,{size:"lg",variant:"ghost",className:"p-0 hover:bg-transparent",onClick:()=>c("prev"),disabled:1>=Number(e),children:[s.jsx(a.default,{src:"/icons/arrow-left.svg",alt:"arrow",width:20,height:20,className:"mr-2"}),"Prev"]}),(0,s.jsxs)("p",{className:"text-14 flex items-center px-2",children:[e," / ",t]}),(0,s.jsxs)(o.z,{size:"lg",variant:"ghost",className:"p-0 hover:bg-transparent",onClick:()=>c("next"),disabled:Number(e)>=t,children:["Next",s.jsx(a.default,{src:"/icons/arrow-left.svg",alt:"arrow",width:20,height:20,className:"ml-2 -scale-x-100"})]})]})}},63438:(e,t,r)=>{"use strict";r.d(t,{TransactionFilters:()=>d});var s=r(40612),a=r(50030),i=r(20297),o=r(35326),n=r(82594),l=r(12043);let c=[{value:"all",label:"All"},{value:"credit",label:"Credits"},{value:"debit",label:"Debits"}],d=({defaultValues:e,exportUrl:t})=>{let r=(0,i.useRouter)(),d=(0,i.usePathname)(),u=(0,i.useSearchParams)(),[p,x]=(0,a.useState)({from:e.from||"",to:e.to||"",direction:e.direction||"all"});return(0,a.useEffect)(()=>{x({from:e.from||"",to:e.to||"",direction:e.direction||"all"})},[e.from,e.to,e.direction,e.bankId]),(0,s.jsxs)("form",{onSubmit:t=>{t.preventDefault();let s=new URLSearchParams(u.toString());s.set("id",e.bankId),p.from?s.set("from",p.from):s.delete("from"),p.to?s.set("to",p.to):s.delete("to"),p.direction&&"all"!==p.direction?s.set("direction",p.direction):s.delete("direction"),s.delete("page"),r.push(`${d}?${s.toString()}`,{scroll:!1})},className:"flex w-full flex-col gap-3 rounded-2xl bg-white p-4 shadow-sm md:flex-row md:items-end",children:[(0,s.jsxs)("div",{className:"flex flex-1 flex-col gap-2",children:[s.jsx("label",{className:"text-sm font-medium text-gray-700",htmlFor:"filter-from",children:"From"}),s.jsx(n.I,{id:"filter-from",type:"date",value:p.from,onChange:e=>x(t=>({...t,from:e.target.value}))})]}),(0,s.jsxs)("div",{className:"flex flex-1 flex-col gap-2",children:[s.jsx("label",{className:"text-sm font-medium text-gray-700",htmlFor:"filter-to",children:"To"}),s.jsx(n.I,{id:"filter-to",type:"date",value:p.to,onChange:e=>x(t=>({...t,to:e.target.value}))})]}),(0,s.jsxs)("div",{className:"flex flex-1 flex-col gap-2",children:[s.jsx("label",{className:"text-sm font-medium text-gray-700",htmlFor:"filter-direction",children:"Direction"}),(0,s.jsxs)(l.Ph,{value:p.direction,onValueChange:e=>x(t=>({...t,direction:e})),children:[s.jsx(l.i4,{id:"filter-direction",children:s.jsx(l.ki,{})}),s.jsx(l.Bw,{children:c.map(e=>s.jsx(l.Ql,{value:e.value,children:e.label},e.value))})]})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-2 md:w-[220px]",children:[s.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Actions"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[s.jsx(o.z,{type:"submit",className:"flex-1",children:"Apply"}),s.jsx(o.z,{type:"button",variant:"outline",onClick:()=>{x({from:"",to:"",direction:"all"});let t=new URLSearchParams(u.toString());t.set("id",e.bankId),t.delete("from"),t.delete("to"),t.delete("direction"),t.delete("page"),r.push(`${d}?${t.toString()}`,{scroll:!1})},children:"Reset"})]}),s.jsx(o.z,{asChild:!0,variant:"ghost",children:s.jsx("a",{href:t,download:!0,children:"Export CSV"})})]})]})}},16671:(e,t,r)=>{"use strict";r.d(t,{t:()=>s});let s=(0,r(85418).createProxy)(String.raw`/Users/kaveh/Horizon-bank/banking/components/Pagination.tsx#Pagination`)},2732:(e,t,r)=>{"use strict";r.d(t,{CE:()=>l,I_:()=>o,P_:()=>c,X4:()=>i});let s=e=>(e instanceof Date?e:new Date(e)).toISOString().slice(0,10),a=e=>{let t=e instanceof Date?e:new Date(e);return new Date(t.getFullYear(),t.getMonth(),t.getDate())},i=(e,t)=>{if(!e?.length)return[];let{from:r,to:s,direction:i}=t,o=r?a(r):null,n=s?a(s):null,l=i&&"all"!==i?i:null;return e.filter(e=>{let t=a(e.date);return(!o||!(t<o))&&(!n||!(t>n))&&(!l||(e.direction||e.type)===l)})},o=(e,t)=>{let r=e.reduce((e,t)=>e+t.amount,0);return{totalCredits:e.filter(e=>e.amount>0).reduce((e,t)=>e+t.amount,0),totalDebits:e.filter(e=>e.amount<0).reduce((e,t)=>e+Math.abs(t.amount),0),netChange:r,openingBalance:t-r,closingBalance:t}},n=e=>{if(null==e)return"";let t=String(e);return/[",\n]/.test(t)?`"${t.replace(/"/g,'""')}"`:t},l=(e,t)=>{let{accountName:r,bankId:a,filters:i}=t,o=[["Account",r],["Bank ID",a],["From",i.from?s(i.from):"—"],["To",i.to?s(i.to):"—"],["Direction",i.direction&&"all"!==i.direction?i.direction:"All"],[]],l=e.map(e=>[s(e.date),e.name,e.amount.toFixed(2),e.direction||e.type||"",e.category||"",e.paymentChannel||e.channel||"",e.source||""]);return[...o.map(e=>e.map(n).join(",")),"Date,Description,Amount,Direction,Category,Payment Channel,Source",...l.map(e=>e.map(n).join(","))].join("\n")},c=(e,t,r)=>{let{accountName:a,officialName:i,period:o,direction:n}=r,l=[];return l.push(`Account: ${a}`),i&&l.push(`Institution: ${i}`),l.push(`Statement Period: ${s(o.from)} to ${s(o.to)}`),n&&"all"!==n&&l.push(`Direction: ${n}`),l.push(`Opening Balance: $${t.openingBalance.toFixed(2)}`),l.push(`Closing Balance: $${t.closingBalance.toFixed(2)}`),l.push(`Total Credits: $${t.totalCredits.toFixed(2)}`),l.push(`Total Debits: $${t.totalDebits.toFixed(2)}`),l.push(""),l.push("Date | Description | Amount | Direction | Category"),e.forEach(e=>{let t=s(e.date),r=e.amount.toFixed(2),a=e.direction||e.type||"",i=e.category||"";l.push(`${t} | ${e.name} | ${r} | ${a} | ${i}`)}),l}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[50,415,403,640,175,711,473,593,564,17,936,899],()=>r(92820));module.exports=s})();
//# sourceMappingURL=page.js.map